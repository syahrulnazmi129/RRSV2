<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maintenance Repair Request System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .notification-badge {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -30px, 0); }
            70% { transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-md bounce-in">
            <div class="text-center mb-8">
                <div class="floating-animation inline-block">
                    <svg class="w-16 h-16 mx-auto text-white mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Maintenance System</h1>
                <p class="text-white/80">Choose your login type</p>
            </div>
            
            <div class="space-y-4">
                <button onclick="showLogin('admin')" class="w-full bg-white/20 hover:bg-white/30 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 backdrop-blur-sm border border-white/20">
                    <div class="flex items-center justify-center">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                        Admin Login
                    </div>
                </button>
                
                <button onclick="showLogin('requestor')" class="w-full bg-white/20 hover:bg-white/30 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 backdrop-blur-sm border border-white/20">
                    <div class="flex items-center justify-center">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Requestor Login
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Login Form -->
    <div id="loginForm" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-md slide-in">
            <div class="text-center mb-8">
                <h2 id="loginTitle" class="text-2xl font-bold text-white mb-2"></h2>
                <p class="text-white/80">Enter your credentials</p>
            </div>
            
            <form id="loginFormElement" class="space-y-6">
                <div>
                    <label class="block text-white/90 text-sm font-medium mb-2">Username</label>
                    <input type="text" id="username" required 
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all duration-200 backdrop-blur-sm"
                           placeholder="Enter username">
                </div>
                
                <div>
                    <label class="block text-white/90 text-sm font-medium mb-2">Password</label>
                    <input type="password" id="password" required 
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all duration-200 backdrop-blur-sm"
                           placeholder="Enter password">
                </div>
                
                <button type="submit" 
                        class="w-full bg-white text-purple-600 font-semibold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg">
                    Login
                </button>
                
                <button type="button" onclick="backToLoginChoice()" 
                        class="w-full bg-transparent border border-white/30 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 hover:bg-white/10">
                    Back
                </button>
            </form>
            
            <div class="mt-6 p-4 bg-white/10 rounded-xl backdrop-blur-sm">
                <p class="text-white/80 text-sm text-center mb-2">Demo Credentials:</p>
                <p class="text-white text-xs">Admin: admin / admin123</p>
                <p class="text-white text-xs">Requestor: user / user123</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-white/10 backdrop-blur-md border-b border-white/20">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <svg class="w-8 h-8 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <h1 class="text-2xl font-bold text-white">Maintenance System</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center text-white">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span id="currentUser" class="font-medium"></span>
                            <span id="userRole" class="ml-2 px-2 py-1 bg-white/20 rounded-full text-xs"></span>
                        </div>
                        
                        <div id="notificationBell" class="relative cursor-pointer" onclick="showNotifications()">
                            <svg class="w-6 h-6 text-white hover:text-yellow-300 transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM10.07 2.82l3.93 3.93-3.93 3.93-3.93-3.93 3.93-3.93zM15 17h5l-5 5v-5z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM10.07 2.82l3.93 3.93-3.93 3.93-3.93-3.93 3.93-3.93z"></path>
                            </svg>
                            <span id="notificationCount" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center notification-badge">0</span>
                        </div>
                        
                        <button onclick="logout()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all duration-200 backdrop-blur-sm">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8">
            <!-- Navigation Tabs -->
            <div class="flex justify-center mb-8">
                <div class="glass-effect rounded-xl p-1 shadow-lg">
                    <button id="formTab" onclick="showTab('form')" class="px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-white text-purple-600 shadow-md">
                        New Request
                    </button>
                    <button id="dashboardTab" onclick="showTab('dashboard')" class="px-6 py-3 rounded-lg font-medium transition-all duration-200 text-white hover:bg-white/20">
                        Dashboard
                    </button>
                </div>
            </div>

            <!-- Request Form -->
            <div id="requestForm" class="max-w-2xl mx-auto">
                <div class="glass-effect rounded-2xl shadow-2xl p-8 slide-in">
                    <h2 class="text-2xl font-semibold text-white mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-3 text-yellow-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Maintenance Repair Request
                    </h2>
                    
                    <form id="maintenanceForm" class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-white/90 text-sm font-medium mb-2">Requestor Name *</label>
                                <input type="text" id="requestorName" required 
                                       class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm"
                                       placeholder="Enter your full name">
                            </div>
                            
                            <div>
                                <label class="block text-white/90 text-sm font-medium mb-2">Department *</label>
                                <select id="department" required 
                                        class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm">
                                    <option value="" class="text-gray-800">Select Department</option>
                                    <option value="Production" class="text-gray-800">Production</option>
                                    <option value="Quality Control" class="text-gray-800">Quality Control</option>
                                    <option value="Warehouse" class="text-gray-800">Warehouse</option>
                                    <option value="Maintenance" class="text-gray-800">Maintenance</option>
                                    <option value="Administration" class="text-gray-800">Administration</option>
                                    <option value="IT" class="text-gray-800">IT</option>
                                    <option value="HR" class="text-gray-800">HR</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-white/90 text-sm font-medium mb-2">Date of Request *</label>
                                <input type="date" id="requestDate" required 
                                       class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm">
                            </div>
                            
                            <div>
                                <label class="block text-white/90 text-sm font-medium mb-2">Time Request (GMT+8) *</label>
                                <input type="time" id="requestTime" required 
                                       class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm">
                            </div>
                        </div>

                        <div>
                            <label class="block text-white/90 text-sm font-medium mb-2">Machine Name *</label>
                            <input type="text" id="machineName" required 
                                   class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm"
                                   placeholder="Enter machine name or ID">
                        </div>

                        <div>
                            <label class="block text-white/90 text-sm font-medium mb-2">Reason for Repair *</label>
                            <textarea id="reason" required rows="4" 
                                      class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm"
                                      placeholder="Describe the issue in detail..."></textarea>
                        </div>

                        <button type="submit" 
                                class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                            <div class="flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                                Submit Request
                            </div>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="hidden">
                <!-- Stats Cards -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="glass-effect rounded-2xl shadow-xl p-6 bounce-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-white/80">Total Requests</p>
                                <p id="totalRequests" class="text-3xl font-bold text-white">0</p>
                            </div>
                            <div class="bg-blue-500/30 p-3 rounded-full backdrop-blur-sm">
                                <svg class="w-6 h-6 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-xl p-6 bounce-in" style="animation-delay: 0.1s;">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-white/80">Pending</p>
                                <p id="pendingRequests" class="text-3xl font-bold text-yellow-300">0</p>
                            </div>
                            <div class="bg-yellow-500/30 p-3 rounded-full backdrop-blur-sm pulse-animation">
                                <svg class="w-6 h-6 text-yellow-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-xl p-6 bounce-in" style="animation-delay: 0.2s;">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-white/80">In Progress</p>
                                <p id="inProgressRequests" class="text-3xl font-bold text-blue-300">0</p>
                            </div>
                            <div class="bg-blue-500/30 p-3 rounded-full backdrop-blur-sm">
                                <svg class="w-6 h-6 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-xl p-6 bounce-in" style="animation-delay: 0.3s;">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-white/80">Completed</p>
                                <p id="completedRequests" class="text-3xl font-bold text-green-300">0</p>
                            </div>
                            <div class="bg-green-500/30 p-3 rounded-full backdrop-blur-sm">
                                <svg class="w-6 h-6 text-green-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Requests Table -->
                <div class="glass-effect rounded-2xl shadow-2xl overflow-hidden">
                    <div class="px-6 py-4 border-b border-white/20">
                        <h3 class="text-lg font-semibold text-white">Recent Requests</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-white/10">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">Request ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">Requestor</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">Department</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">Machine</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">Status</th>
                                    <th id="actionsHeader" class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="requestsTableBody" class="divide-y divide-white/10">
                                <tr>
                                    <td colspan="7" class="px-6 py-8 text-center text-white/60">
                                        No requests submitted yet. Submit your first request using the form above!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-effect rounded-2xl p-8 max-w-md mx-4 transform transition-all duration-300 bounce-in">
            <div class="text-center">
                <div class="bg-green-500/30 rounded-full p-3 w-16 h-16 mx-auto mb-4 backdrop-blur-sm">
                    <svg class="w-10 h-10 text-green-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2">Request Submitted!</h3>
                <p class="text-white/80 mb-6">Your maintenance request has been successfully submitted and assigned ID: <span id="requestId" class="font-semibold text-yellow-300"></span></p>
                <button onclick="closeModal()" class="bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white px-6 py-2 rounded-lg transition-all duration-200 transform hover:scale-105">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="hidden fixed top-20 right-4 glass-effect rounded-xl p-4 w-80 z-50 slide-in">
        <h4 class="text-white font-semibold mb-3">Recent Notifications</h4>
        <div id="notificationList" class="space-y-2 max-h-60 overflow-y-auto">
            <p class="text-white/60 text-sm">No new notifications</p>
        </div>
    </div>

    <!-- Status Update Modal -->
    <div id="statusModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-effect rounded-2xl p-8 max-w-md mx-4 w-full transform transition-all duration-300 bounce-in">
            <div class="text-center mb-6">
                <div class="bg-blue-500/30 rounded-full p-3 w-16 h-16 mx-auto mb-4 backdrop-blur-sm">
                    <svg class="w-10 h-10 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2">Update Request Status</h3>
                <p class="text-white/80">Request ID: <span id="modalRequestId" class="font-semibold text-yellow-300"></span></p>
            </div>
            
            <form id="statusUpdateForm" class="space-y-4">
                <div>
                    <label class="block text-white/90 text-sm font-medium mb-2">New Status *</label>
                    <select id="newStatus" required 
                            class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm">
                        <option value="Pending" class="text-gray-800">Pending</option>
                        <option value="In Progress" class="text-gray-800">In Progress</option>
                        <option value="Completed" class="text-gray-800">Completed</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-white/90 text-sm font-medium mb-2">Admin Comment *</label>
                    <textarea id="adminComment" rows="3" required
                              class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200 backdrop-blur-sm"
                              placeholder="Please add a comment explaining this status update..."></textarea>
                    <p class="text-white/60 text-xs mt-1">Comment is required before updating status</p>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" 
                            class="flex-1 bg-gradient-to-r from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105">
                        Update Status
                    </button>
                    <button type="button" onclick="closeStatusModal()" 
                            class="flex-1 bg-transparent border border-white/30 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 hover:bg-white/10">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Comments Modal -->
    <div id="commentsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-effect rounded-2xl p-8 max-w-lg mx-4 w-full transform transition-all duration-300 bounce-in">
            <div class="text-center mb-6">
                <div class="bg-green-500/30 rounded-full p-3 w-16 h-16 mx-auto mb-4 backdrop-blur-sm">
                    <svg class="w-10 h-10 text-green-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2">Admin Comments</h3>
                <p class="text-white/80">Request ID: <span id="commentsRequestId" class="font-semibold text-yellow-300"></span></p>
            </div>
            
            <div id="commentsContent" class="space-y-3 max-h-60 overflow-y-auto mb-6">
                <!-- Comments will be populated here -->
            </div>
            
            <button onclick="closeCommentsModal()" 
                    class="w-full bg-transparent border border-white/30 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 hover:bg-white/10">
                Close
            </button>
        </div>
    </div>

    <script>
        let currentUserType = '';
        let currentUsername = '';
        let requests = [];
        let requestCounter = 1;
        let notifications = [];

        // Set current date and time
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const dateInput = document.getElementById('requestDate');
            const timeInput = document.getElementById('requestTime');
            
            if (dateInput) {
                dateInput.value = now.toISOString().split('T')[0];
            }
            if (timeInput) {
                timeInput.value = now.toTimeString().slice(0, 5);
            }
        });

        function showLogin(userType) {
            currentUserType = userType;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginTitle').textContent = userType.charAt(0).toUpperCase() + userType.slice(1) + ' Login';
        }

        function backToLoginChoice() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            currentUserType = '';
        }

        document.getElementById('loginFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple authentication
            if ((currentUserType === 'admin' && username === 'admin' && password === 'admin123') ||
                (currentUserType === 'requestor' && username === 'user' && password === 'user123')) {
                
                currentUsername = username;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Update header
                document.getElementById('currentUser').textContent = username;
                document.getElementById('userRole').textContent = currentUserType;
                
                // Show/hide admin features
                if (currentUserType === 'admin') {
                    document.getElementById('actionsHeader').classList.remove('hidden');
                } else {
                    document.getElementById('actionsHeader').classList.add('hidden');
                }
                
                updateDashboard();
            } else {
                alert('Invalid credentials. Please try again.');
            }
        });

        function logout() {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            currentUserType = '';
            currentUsername = '';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showTab(tab) {
            if (tab === 'form') {
                document.getElementById('requestForm').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('formTab').classList.add('bg-white', 'text-purple-600', 'shadow-md');
                document.getElementById('formTab').classList.remove('text-white');
                document.getElementById('dashboardTab').classList.remove('bg-white', 'text-purple-600', 'shadow-md');
                document.getElementById('dashboardTab').classList.add('text-white');
            } else {
                document.getElementById('requestForm').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('dashboardTab').classList.add('bg-white', 'text-purple-600', 'shadow-md');
                document.getElementById('dashboardTab').classList.remove('text-white');
                document.getElementById('formTab').classList.remove('bg-white', 'text-purple-600', 'shadow-md');
                document.getElementById('formTab').classList.add('text-white');
                updateDashboard();
            }
        }

        document.getElementById('maintenanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                id: 'REQ-' + String(requestCounter).padStart(4, '0'),
                requestorName: document.getElementById('requestorName').value,
                department: document.getElementById('department').value,
                requestDate: document.getElementById('requestDate').value,
                requestTime: document.getElementById('requestTime').value,
                machineName: document.getElementById('machineName').value,
                reason: document.getElementById('reason').value,
                status: 'Pending',
                submittedBy: currentUsername,
                submittedAt: new Date().toISOString()
            };
            
            requests.push(formData);
            requestCounter++;
            
            // Add notification
            addNotification(`New request ${formData.id} submitted by ${formData.requestorName}`);
            
            // Show success modal
            document.getElementById('requestId').textContent = formData.id;
            document.getElementById('successModal').classList.remove('hidden');
            
            // Reset form
            document.getElementById('maintenanceForm').reset();
            
            // Set current date and time again
            const now = new Date();
            document.getElementById('requestDate').value = now.toISOString().split('T')[0];
            document.getElementById('requestTime').value = now.toTimeString().slice(0, 5);
            
            updateDashboard();
        });

        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        function updateDashboard() {
            const total = requests.length;
            const pending = requests.filter(r => r.status === 'Pending').length;
            const inProgress = requests.filter(r => r.status === 'In Progress').length;
            const completed = requests.filter(r => r.status === 'Completed').length;
            
            document.getElementById('totalRequests').textContent = total;
            document.getElementById('pendingRequests').textContent = pending;
            document.getElementById('inProgressRequests').textContent = inProgress;
            document.getElementById('completedRequests').textContent = completed;
            
            updateRequestsTable();
        }

        function updateRequestsTable() {
            const tbody = document.getElementById('requestsTableBody');
            
            if (requests.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-white/60">
                            No requests submitted yet. Submit your first request using the form above!
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = requests.map(request => {
                const statusColor = {
                    'Pending': 'bg-yellow-500/20 text-yellow-300',
                    'In Progress': 'bg-blue-500/20 text-blue-300',
                    'Completed': 'bg-green-500/20 text-green-300'
                };
                
                const actionsColumn = currentUserType === 'admin' ? `
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="showStatusModal('${request.id}', '${request.status}')" 
                                class="bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg px-3 py-1 text-blue-300 text-xs transition-all duration-200">
                            Update Status
                        </button>
                    </td>
                ` : '<td class="px-6 py-4 whitespace-nowrap text-sm text-white/60">-</td>';
                
                const hasComments = request.comments && request.comments.length > 0;
                const latestComment = hasComments ? request.comments[request.comments.length - 1] : null;
                
                return `
                    <tr class="hover:bg-white/5 transition-colors duration-200">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">${request.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white/80">${request.requestorName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white/80">${request.department}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white/80">${request.machineName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white/80">${request.requestDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex flex-col">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${statusColor[request.status]} mb-1">
                                    ${request.status}
                                </span>
                                ${hasComments ? `
                                    <button onclick="showComments('${request.id}')" 
                                            class="text-xs text-blue-300 hover:text-blue-200 underline">
                                        View Comments (${request.comments.length})
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                        ${actionsColumn}
                    </tr>
                `;
            }).join('');
        }

        let currentRequestId = '';

        function showStatusModal(requestId, currentStatus) {
            currentRequestId = requestId;
            document.getElementById('modalRequestId').textContent = requestId;
            document.getElementById('newStatus').value = currentStatus;
            document.getElementById('adminComment').value = '';
            document.getElementById('statusModal').classList.remove('hidden');
        }

        function closeStatusModal() {
            document.getElementById('statusModal').classList.add('hidden');
            currentRequestId = '';
        }

        document.getElementById('statusUpdateForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newStatus = document.getElementById('newStatus').value;
            const comment = document.getElementById('adminComment').value;
            
            updateStatus(currentRequestId, newStatus, comment);
            closeStatusModal();
        });

        function updateStatus(requestId, newStatus, comment = '') {
            const request = requests.find(r => r.id === requestId);
            if (request) {
                const oldStatus = request.status;
                request.status = newStatus;
                
                // Initialize comments array if it doesn't exist
                if (!request.comments) {
                    request.comments = [];
                }
                
                // Always add comment (now required)
                request.comments.push({
                    text: comment.trim(),
                    admin: currentUsername,
                    timestamp: new Date().toLocaleString(),
                    statusChange: `${oldStatus} → ${newStatus}`
                });
                
                const notificationText = `Request ${requestId} status changed from ${oldStatus} to ${newStatus} with comment: "${comment}"`;
                
                addNotification(notificationText);
                updateDashboard();
            }
        }

        function showComments(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (request && request.comments && request.comments.length > 0) {
                document.getElementById('commentsRequestId').textContent = requestId;
                
                const commentsContent = document.getElementById('commentsContent');
                commentsContent.innerHTML = request.comments.map(comment => `
                    <div class="bg-white/10 rounded-lg p-4 backdrop-blur-sm">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-blue-300 font-medium text-sm">${comment.admin}</span>
                            <span class="text-white/60 text-xs">${comment.timestamp}</span>
                        </div>
                        <div class="text-yellow-300 text-xs mb-2 font-medium">
                            Status Change: ${comment.statusChange}
                        </div>
                        <p class="text-white text-sm">${comment.text}</p>
                    </div>
                `).join('');
                
                document.getElementById('commentsModal').classList.remove('hidden');
            }
        }

        function closeCommentsModal() {
            document.getElementById('commentsModal').classList.add('hidden');
        }

        function addNotification(message) {
            notifications.unshift({
                message: message,
                timestamp: new Date().toLocaleString(),
                id: Date.now()
            });
            
            // Keep only last 10 notifications
            if (notifications.length > 10) {
                notifications = notifications.slice(0, 10);
            }
            
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationCount');
            if (notifications.length > 0) {
                badge.textContent = notifications.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function showNotifications() {
            const panel = document.getElementById('notificationPanel');
            const list = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                list.innerHTML = '<p class="text-white/60 text-sm">No new notifications</p>';
            } else {
                list.innerHTML = notifications.map(notif => `
                    <div class="bg-white/10 rounded-lg p-3 backdrop-blur-sm">
                        <p class="text-white text-sm">${notif.message}</p>
                        <p class="text-white/60 text-xs mt-1">${notif.timestamp}</p>
                    </div>
                `).join('');
            }
            
            panel.classList.toggle('hidden');
            
            // Clear notifications after viewing
            setTimeout(() => {
                notifications = [];
                updateNotificationBadge();
            }, 3000);
        }

        // Close notification panel when clicking outside
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('notificationPanel');
            const bell = document.getElementById('notificationBell');
            
            if (!panel.contains(e.target) && !bell.contains(e.target)) {
                panel.classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97acb77f13b513e0',t:'MTc1NzE0ODYwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
